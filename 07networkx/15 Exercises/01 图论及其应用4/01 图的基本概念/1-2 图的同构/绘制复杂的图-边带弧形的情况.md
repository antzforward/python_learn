# 完全自定义 NetworkX 图形：Peterson 图的高级可视化

下面我将展示如何使用 NetworkX 完全自定义绘制一个 Peterson 图，包括自定义节点位置、边、标题和整体样式，使其达到出版质量。

```python
import networkx as nx
import matplotlib.pyplot as plt
import numpy as np
from matplotlib.lines import Line2D  # 用于自定义图例
import matplotlib.colors as mcolors
import matplotlib.cm as cm

# 初始化图形
plt.figure(figsize=(12, 10), dpi=100)

# 创建空的有向图
G = nx.DiGraph()

# ========================
# 1. 完全自定义节点位置
# ========================

# Peterson图有10个节点：外环5个，内环5个
outer_nodes = [0, 1, 2, 3, 4]
inner_nodes = [5, 6, 7, 8, 9]
all_nodes = outer_nodes + inner_nodes

# 自定义位置字典 - 精确控制每个节点的坐标
pos = {}

# 外环节点：大圆
outer_radius = 3
for i, node in enumerate(outer_nodes):
    angle = 2 * np.pi * i / 5 - np.pi/2  # 从顶部开始（-90度）
    pos[node] = (outer_radius * np.cos(angle), outer_radius * np.sin(angle))

# 内环节点：小圆
inner_radius = 1.5
for i, node in enumerate(inner_nodes):
    angle = 2 * np.pi * i / 5 - np.pi/2 + np.pi/5  # 旋转36度（π/5）
    pos[node] = (inner_radius * np.cos(angle), inner_radius * np.sin(angle))

# ========================
# 2. 添加边 - 完全自定义
# ========================

# 外环的边（实线）
outer_edges = [
    (0, 1), (1, 2), (2, 3), (3, 4), (4, 0),
    # 可选双向边，增加箭头
    (1, 0), (2, 1), (3, 2), (4, 3), (0, 4)
]

# 内环的边（虚线）
inner_edges = [
    (5, 7), (7, 9), (9, 6), (6, 8), (8, 5),
    # 可选双向边
    (7, 5), (9, 7), (6, 9), (8, 6), (5, 8)
]

# 内外环连接的边（不同颜色）
connecting_edges = [
    (0, 5), (1, 6), (2, 7), (3, 8), (4, 9),
    # 可选反向连接
    (5, 0), (6, 1), (7, 2), (8, 3), (9, 4)
]

# 将边添加到图中
G.add_edges_from(outer_edges, style='solid', width=2, color='#1f77b4', name='Outer')
G.add_edges_from(inner_edges, style='dashed', width=2, color='#ff7f0e', name='Inner')
G.add_edges_from(connecting_edges, style='solid', width=2.5, color='#2ca02c', name='Connection')

# ========================
# 3. 绘制节点 - 自定义样式
# ========================

# 创建颜色映射以区分内外环节点
colors = []
for node in all_nodes:
    if node in outer_nodes:
        colors.append(mcolors.to_rgba('#1f77b4', alpha=0.85))  # 外环蓝色
    else:
        colors.append(mcolors.to_rgba('#ff7f0e', alpha=0.85))  # 内环橙色

# 节点大小控制
node_sizes = [450 if node in outer_nodes else 380 for node in all_nodes]

# 绘制节点
nx.draw_networkx_nodes(
    G, pos,
    nodelist=all_nodes,
    node_size=node_sizes,
    node_color=colors,
    edgecolors=['#444444' if node in outer_nodes else '#dddddd' for node in all_nodes],
    linewidths=[3.0 if node in outer_nodes else 2.0 for node in all_nodes],
    node_shape='o',
    alpha=0.95
)

# ========================
# 4. 绘制边 - 完全自定义样式
# ========================

# 按不同类别分开绘制边
edge_groups = {
    'outer_edges': outer_edges,
    'inner_edges': inner_edges,
    'connecting_edges': connecting_edges
}

# 为每组边设置样式
for group, edges in edge_groups.items():
    # 获取边的自定义属性
    edge_data = [G.get_edge_data(u, v) for (u, v) in edges]
    
    # 提取所有边的属性
    widths = [d.get('width', 2.0) for d in edge_data]
    colors = [d.get('color', '#000000') for d in edge_data]
    
    # 特殊的样式处理
    if group == 'inner_edges':
        # 绘制虚线
        nx.draw_networkx_edges(
            G, pos,
            edgelist=edges,
            width=widths,
            edge_color=colors,
            style='dashed',
            arrows=True,
            arrowstyle='->',
            arrowsize=18,
            alpha=0.85
        )
    else:
        # 实线，使用循环效果绘制弯曲边
        for i, (u, v) in enumerate(edges):
            nx.draw_networkx_edges(
                G, pos,
                edgelist=[(u, v)],
                width=[widths[i]],
                edge_color=[colors[i]],
                connectionstyle=f'arc3, rad=0.2',  # 添加轻微弯曲
                arrows=True,
                arrowstyle='->',
                arrowsize=18 if group == 'connecting_edges' else 12,
                alpha=0.9
            )

# ========================
# 5. 添加标签 - 自定义格式
# ========================

# 设置标签字体和样式
font_options = {
    'font_size': 14,
    'font_weight': 'bold',
    'font_family': 'sans-serif',
}

# 外环节点标签
outer_labels = {i: f'V{i}' for i in outer_nodes}
nx.draw_networkx_labels(G, pos, labels=outer_labels, **font_options, font_color='white')

# 内环节点标签（不同样式）
inner_labels = {i: f'V{i}' for i in inner_nodes}
nx.draw_networkx_labels(G, pos, labels=inner_labels, **font_options, font_color='black')

# ========================
# 6. 添加标题和副标题
# ========================

# 主标题
plt.suptitle('Peterson Graph: Advanced Visualization', 
             fontsize=20, 
             fontweight='bold',
             fontfamily='serif',
             y=0.95)

# 副标题
plt.title('Complete Customization of Position, Edges, and Labels using NetworkX', 
          fontsize=14, 
          fontfamily='sans-serif',
          pad=15,
          color='#555555')

# ========================
# 7. 添加图例
# ========================

# 自定义图例
legend_elements = [
    Line2D([0], [0], 
           color='#1f77b4', 
           linewidth=3, 
           label='Outer Ring Connections'),
    Line2D([0], [0], 
           color='#ff7f0e', 
           linewidth=3, 
           linestyle='--', 
           label='Inner Star Connections'),
    Line2D([0], [0], 
           color='#2ca02c', 
           linewidth=3, 
           label='Interconnections'),
    plt.Circle((0, 0), 
               radius=0.5, 
               color='#1f77b4', 
               alpha=0.7, 
               label='Outer Vertices'),
    plt.Circle((0, 0), 
               radius=0.5, 
               color='#ff7f0e', 
               alpha=0.7, 
               label='Inner Vertices')
]

plt.legend(handles=legend_elements, 
           loc='upper left', 
           frameon=True, 
           framealpha=0.95,
           title="Graph Elements",
           title_fontsize=13,
           fontsize=11)

# ========================
# 8. 完善布局和样式
# ========================

# 设置背景颜色
plt.gca().set_facecolor('#f5f5f5')

# 添加网格（极坐标形式）
ax = plt.gca()
ax.grid(False)

# 绘制参考圆（增加视觉效果）
for radius in [1.0, 2.0, 3.0]:
    circle = plt.Circle((0, 0), radius, fill=False, color='#cccccc', linestyle=':', alpha=0.4)
    ax.add_patch(circle)

# 调整坐标轴范围
buffer = 0.15 * outer_radius
plt.xlim(-outer_radius - buffer, outer_radius + buffer)
plt.ylim(-outer_radius - buffer, outer_radius + buffer)

# 添加中心点（增强视觉效果）
plt.plot(0, 0, 'o', markersize=10, color='#d62728', alpha=0.7)

# 添加刻度线（可选）
plt.xticks(np.arange(-3.5, 4.0, 1.0))
plt.yticks(np.arange(-3.5, 4.0, 1.0))

# 添加角柱注释
plt.text(-outer_radius - buffer, outer_radius + buffer - 0.5, 
         'Figure: Complete Peterson Graph Visualization\nDate: 2023-08-15',
         fontsize=10,
         fontfamily='monospace',
         bbox=dict(facecolor='white', alpha=0.7))

# 关闭坐标轴边框
ax.set_frame_on(True)

# 保存高质量图像
plt.savefig('custom_peterson_graph.png', dpi=300, bbox_inches='tight', transparent=False)

# 显示图形
plt.tight_layout()
plt.show()
```

## 关键自定义技巧详解

### 1. 精确控制节点位置

```python
# 创建精确位置字典
pos = {}

# 外环位置计算（大圆）
outer_radius = 3
for i, node in enumerate([0, 1, 2, 3, 4]):
    angle = 2 * np.pi * i / 5 - np.pi/2
    pos[node] = (outer_radius * np.cos(angle), outer_radius * np.sin(angle))

# 内环位置计算（小圆）
inner_radius = 1.5
for i, node in enumerate([5, 6, 7, 8, 9]):
    angle = 2 * np.pi * i / 5 - np.pi/2 + np.pi/5
    pos[node] = (inner_radius * np.cos(angle), inner_radius * np.sin(angle))
```

### 2. 分类型绘制边（精确控制样式）

```python
# 分别绘制三种类型的边
# 外环边（蓝色实线）
nx.draw_networkx_edges(
    G, pos,
    edgelist=outer_edges,
    width=2,
    edge_color='#1f77b4',
    connectionstyle='arc3, rad=0.1',  # 添加弯曲效果
    arrows=True,
    arrowsize=12
)

# 内环边（橙色虚线）
nx.draw_networkx_edges(
    G, pos,
    edgelist=inner_edges,
    width=2,
    edge_color='#ff7f0e',
    style='dashed',
    connectionstyle='arc3, rad=0.2',  # 更大弯曲度
    arrows=True,
    arrowsize=15
)

# 连接边（绿色加粗）
nx.draw_networkx_edges(
    G, pos,
    edgelist=connecting_edges,
    width=2.5,
    edge_color='#2ca02c',
    connectionstyle='arc3, rad=0.15',  # 中等弯曲度
    arrows=True,
    arrowsize=15
)
```

### 3. 专业标题设计

```python
# 主标题
plt.suptitle('Peterson Graph: Advanced Visualization', 
             fontsize=20, 
             fontweight='bold',
             fontfamily='serif',
             y=0.95)  # 位置调整

# 副标题（带间距和色彩）
plt.title('Complete Customization of Position, Edges, and Labels using NetworkX', 
          fontsize=14, 
          fontfamily='sans-serif',
          pad=15,  # 增加间距
          color='#555555')  # 深灰色
```

### 4. 高级视觉效果

```python
# 背景网格
ax = plt.gca()
ax.grid(False)

# 绘制参考圆（增强布局感）
for radius in [1.0, 2.0, 3.0]:
    circle = plt.Circle((0, 0), radius, fill=False, color='#cccccc', linestyle=':', alpha=0.4)
    ax.add_patch(circle)

# 中心点（增强视觉焦点）
plt.plot(0, 0, 'o', markersize=10, color='#d62728', alpha=0.7)

# 角柱注释（专业图表元素）
plt.text(-4, 3.7, 
         'Figure: Custom Peterson Graph\nAuthor: Your Name',
         fontsize=10,
         fontfamily='monospace',
         bbox=dict(facecolor='white', alpha=0.7))
```

## 输出效果说明

这个自定义版本提供了以下增强效果：

1. **精确位置控制**：
   - 外环节点均匀分布在大圆上
   - 内环节点均匀分布在小圆上，旋转36度形成星形结构

2. **分类边样式**：
   - 外环边：蓝色实线，轻微弯曲
   - 内环边：橙色虚线，更大弯曲度
   - 连接边：绿色加粗，中等弯曲度

3. **专业标签**：
   - 外环节点白色标签（与蓝色背景形成对比）
   - 内环节点黑色标签（与橙色背景形成对比）
   - 主副标题分层设计

4. **视觉增强元素**：
   - 参考圆增强布局感
   - 中心点增加视觉焦点
   - 分类图例明确区分图元素
   - 角柱提供专业图表信息

5. **高质量输出**：
   - 300dpi高分辨率保存
   - 自定义大小和背景
   - 透明背景选项

通过这种方式，你可以完全控制每个元素的精确位置、样式和交互效果，创建比原始 NetworkX 绘图更符合学术或演示需求的定制化图表。